<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:IpShared.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="IpShared.Views.HostClientView"
             x:DataType="vm:HostClientViewModel">
    <TabControl Margin="15">
        <!-- MODO HOST -->
        <TabItem Header="Hospedar Sessão (Cliente)">
            <Grid RowDefinitions="Auto, Auto, *, Auto" Margin="10">
                <StackPanel Grid.Row="0" Spacing="10">
                    <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                        <Button Content="Iniciar Host" Command="{Binding StartHostAsync}" IsEnabled="{Binding !IsHostRunning}" Classes="accent"/>
                        <Button Content="Parar Host" Command="{Binding StopHost}" IsEnabled="{Binding IsHostRunning}"/>
                        <CheckBox Content="Usar IP Fixo" IsChecked="{Binding UseFixedIp}" IsEnabled="{Binding !IsHostRunning}"/>
                        <TextBlock Text="Porta:" VerticalAlignment="Center" Margin="10,0,0,0"/>
                        <TextBox Text="{Binding HostPort}" Width="80" IsEnabled="{Binding !IsHostRunning}" Watermark="0-65535"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center" IsVisible="{Binding UseFixedIp}">
                        <CheckBox Content="Usar IP Local (Rede)" IsChecked="{Binding UseLocalIp}" IsEnabled="{Binding !IsHostRunning}"/>
                        <TextBlock Text="IP:" VerticalAlignment="Center"/>
                        <TextBox Text="{Binding HostIp}" Width="150" IsEnabled="{Binding !IsHostRunning}" Watermark="0.0.0.0 - 255.255.255.255"/>
                    </StackPanel>
                </StackPanel>

                <!-- Seletor de Formato de Convite -->
                <Border Grid.Row="1" Margin="0,10,0,0" Padding="10" CornerRadius="5"
                        Background="{DynamicResource SystemControlPageBackgroundListLowBrush}"
                        IsVisible="{Binding DefaultInvite, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                    <Grid RowDefinitions="Auto,Auto,Auto">
                        <TextBlock Grid.Row="0" Text="Convite Gerado:" FontWeight="Bold" Margin="0,0,0,10"/>
                        
                        <!-- Formato com botões -->
                        <Grid Grid.Row="1" ColumnDefinitions="Auto,*,Auto,Auto" Margin="0,0,0,10">
                            <TextBlock Grid.Column="0" 
                                      Text="Formato:" 
                                      FontWeight="SemiBold" 
                                      VerticalAlignment="Center"
                                      Margin="0,0,10,0"/>
                            <ComboBox Grid.Column="1" 
                                     ItemsSource="{Binding AvailableFormats}"
                                     SelectedItem="{Binding SelectedFormat}"
                                     MinWidth="200"/>
                            <Button Grid.Column="2" 
                                   Content="Copiar" 
                                   Command="{Binding CopyBase64}"
                                   Padding="15,5"
                                   Margin="10,0,0,0"/>
                            <Button Grid.Column="3" 
                                   Content="Visualizar Imagem" 
                                   Command="{Binding ShowQrCodeImage}"
                                   Padding="15,5"
                                   Margin="10,0,0,0"
                                   IsVisible="{Binding IsQrCodeFormat}"/>
                        </Grid>
                        
                        <!-- Código -->
                        <Grid Grid.Row="2" ColumnDefinitions="Auto,*">
                            <TextBlock Grid.Column="0" 
                                      Text="Código:" 
                                      FontWeight="SemiBold" 
                                      VerticalAlignment="Top"
                                      Margin="0,5,10,0"/>
                            <ScrollViewer Grid.Column="1" 
                                         MaxHeight="120"
                                         VerticalScrollBarVisibility="Auto">
                                <TextBox Text="{Binding DisplayedInvite}" 
                                        IsReadOnly="True" 
                                        TextWrapping="Wrap"
                                        MinHeight="80"
                                        AcceptsReturn="True"
                                        BorderThickness="0"/>
                            </ScrollViewer>
                        </Grid>
                    </Grid>
                </Border>

                <ScrollViewer Grid.Row="2" Margin="0,10,0,0">
                    <TextBox Text="{Binding HostLog}" AcceptsReturn="True" TextWrapping="Wrap" IsReadOnly="True" />
                </ScrollViewer>
            </Grid>
        </TabItem>
        
        <!-- MODO CLIENTE -->
        <TabItem Header="Conectar a Sessão (Cliente)">
            <Grid RowDefinitions="Auto, *, Auto" Margin="10">
                <StackPanel Grid.Row="0" Spacing="10">
                     <TextBox Text="{Binding ClientInviteCode}" Watermark="Cole o código do convite aqui"/>
                     <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                         <CheckBox Content="Mensagem Personalizada" IsChecked="{Binding UseCustomMessage}"/>
                         <TextBox Text="{Binding CustomMessage}" Width="300" IsEnabled="{Binding UseCustomMessage}" Watermark="Mensagem a enviar..."/>
                     </StackPanel>
                     <CheckBox Content="Indicar formato detectado" IsChecked="{Binding SpecifyFormat}"/>
                     <Button Content="Conectar" Command="{Binding ConnectClientAsync}" IsEnabled="{Binding !IsConnecting}" Classes="accent"/>
                </StackPanel>
                
                <ScrollViewer Grid.Row="1" Margin="0,10,0,0">
                    <TextBox Text="{Binding ClientLog}" AcceptsReturn="True" TextWrapping="Wrap" IsReadOnly="True" />
                </ScrollViewer>
            </Grid>
        </TabItem>
    </TabControl>
</UserControl>
