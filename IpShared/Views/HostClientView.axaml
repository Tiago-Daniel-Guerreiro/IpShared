<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:IpShared.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="IpShared.Views.HostClientView"
             x:DataType="vm:HostClientViewModel">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
    <StackPanel Margin="8" Spacing="12">
        <!-- Hospedar -->
        <Border Padding="8" CornerRadius="6" Background="{DynamicResource SystemControlPageBackgroundListLowBrush}">
            <StackPanel Spacing="6">
                <TextBlock Text="Hospedar" FontWeight="Bold" FontSize="14"/>
                <StackPanel Spacing="6">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <Button Content="Iniciar Host" Command="{Binding StartHostAsync}" IsEnabled="{Binding !IsHostRunning}" Classes="accent"/>
                        <Button Content="Parar Host" Command="{Binding StopHost}" IsEnabled="{Binding IsHostRunning}"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                        <TextBlock Text="Porta:" VerticalAlignment="Center" Margin="0,0,6,0" FontSize="12"/>
                        <TextBox Text="{Binding HostPort}" Width="90" IsEnabled="{Binding !IsHostRunning}" Watermark="0-65535"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                        <CheckBox Content="Usar IP Fixo (127.0.0.1)" IsChecked="{Binding UseFixedIp}" IsEnabled="{Binding !IsHostRunning}"/>
                    </StackPanel>

                    <Grid ColumnDefinitions="Auto,Auto" VerticalAlignment="Center" IsVisible="{Binding !UseFixedIp}">
                        <TextBlock Grid.Column="0" Text="Usar IP Local (Rede):" VerticalAlignment="Center" FontWeight="SemiBold" FontSize="12"/>
                        <TextBox Grid.Column="1" Name="HostIpTextBox" Text="{Binding HostIp}" Width="150" IsEnabled="{Binding !IsHostRunning}" Watermark="192.168.x.x" GotFocus="OnInputGotFocus" PointerPressed="OnTextBoxAuto"/>
                    </Grid>

                    <Border Margin="0,10,0,0" Padding="10" CornerRadius="5" Background="{DynamicResource SystemControlPageBackgroundListLowBrush}" IsVisible="{Binding DefaultInvite, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                        <Grid RowDefinitions="Auto,Auto,Auto,Auto">
                            <TextBlock Grid.Row="0" Text="Convite Gerado:" FontWeight="Bold" Margin="0,0,0,5" FontSize="10"/>
                            <WrapPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,10">
                                <TextBlock Text="Formato:" FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,6,6,0" FontSize="14"/>
                                <ComboBox ItemsSource="{Binding AvailableFormats}" SelectedItem="{Binding SelectedFormat}" MinWidth="160" Width="200"/>
                                <Button Content="Copiar" Command="{Binding CopyBase64}" Padding="12,6" MinWidth="80"/>
                                <!-- Abrir por toque no texto: botão removido por redundância -->
                                <Button Content="Abrir QR Code" Command="{Binding ShowQrCodeImage}" Padding="12,6" MinWidth="110" IsVisible="{Binding IsQrCodeFormatDesktop}"/>
                                <Button Content="Mostrar QR Code" Command="{Binding ShowQrCodeImage}" Padding="12,6" MinWidth="110" IsVisible="{Binding IsQrCodeFormatAndroid}"/>
                            </WrapPanel>

                            <Grid Grid.Row="2" ColumnDefinitions="Auto,*">
                                <TextBlock Grid.Column="0" Text="Código:" FontWeight="SemiBold" VerticalAlignment="Top" Margin="0,5,10,0" FontSize="14"/>
                                <Border Grid.Column="1" BorderBrush="LightGray" BorderThickness="1" CornerRadius="3" Padding="8">
                                    <ScrollViewer MaxHeight="100" VerticalScrollBarVisibility="Auto">
                                        <TextBox Name="DisplayedInviteTextBox" Text="{Binding DisplayedInvite}" IsReadOnly="True" TextWrapping="Wrap" MinHeight="80" AcceptsReturn="True" BorderThickness="0" PointerPressed="OnTextBoxAuto"/>
                                    </ScrollViewer>
                                </Border>
                            </Grid>

                            <Border Grid.Row="3" BorderBrush="LightGray" BorderThickness="1" CornerRadius="5" Padding="10" Margin="0,10,0,0" HorizontalAlignment="Center" IsVisible="{Binding QrCodeImage, Converter={x:Static ObjectConverters.IsNotNull}}">
                                <StackPanel Spacing="5" HorizontalAlignment="Center">
                                    <TextBlock Text="QR Code:" FontWeight="Bold" HorizontalAlignment="Center" FontSize="10"/>
                                    <Image Source="{Binding QrCodeImage}" Width="200" Height="200"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </Border>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Cliente -->
        <Border Padding="8" CornerRadius="6" Background="{DynamicResource SystemControlPageBackgroundListLowBrush}">
            <StackPanel Spacing="8">
                <TextBlock Text="Conectar" FontWeight="Bold" FontSize="14"/>
                <TextBox Name="ClientInviteTextBox" Text="{Binding ClientInviteCode}" Watermark="Introduza o código do convite aqui" GotFocus="OnInputGotFocus" PointerPressed="OnTextBoxAuto"/>
                <CheckBox Content="Mensagem Personalizada" IsChecked="{Binding UseCustomMessage}"/>
                <TextBox Text="{Binding CustomMessage}" Width="300" IsEnabled="{Binding UseCustomMessage}" IsVisible="{Binding UseCustomMessage}" Watermark="Mensagem a enviar..." PointerPressed="OnTextBoxAuto"/>
                <CheckBox Content="Indicar formato" IsChecked="{Binding SpecifyFormat}"/>
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <Button Content="Conectar" Command="{Binding ConnectClientAsync}" IsEnabled="{Binding !IsConnecting}" Classes="accent"/>
                    <Button Content="Escanear QR" Command="{Binding ScanQrCodeAsync}" IsVisible="{Binding IsMobile}"/>
                </StackPanel>
                <TextBlock Text="Aviso: Apenas compatível com requisições na rede local" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" FontSize="12" Margin="0,5,0,0" TextWrapping="Wrap"/>
                <ScrollViewer Height="140" Margin="0,6,0,0">
                    <TextBox Name="ClientLogTextBox" Text="{Binding ClientLog}" AcceptsReturn="True" TextWrapping="Wrap" IsReadOnly="True" PointerPressed="OnLogTextBoxPointerPressed" />
                </ScrollViewer>
            </StackPanel>
        </Border>
    </StackPanel>
    </ScrollViewer>
</UserControl>
